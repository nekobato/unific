!function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};$(function(){var e,n,i,r,a,o,s,c,l,u,d,m,f,p,h,b,g,v,y,k,w,x,B,I,F,C,D,H,V,A,L,q;return $(".alert").hide(),$("button.close").click(function(t){return t.currentTarget.parentElement.style.display="none"}),L=io.connect(),V=window.location.pathname.substr(1),D=!0,F=[],p=$("#GoButton"),h=$("#GoInput"),i=$("#Articles"),r=$("#AbsoluteBackground"),f=$("#FindFeedInput"),g=$("#ImageInput"),b=$("#Description"),m=$("#FindFeedButton"),e=$("#AddFeedButton"),c=$("#EditFeedButton"),n=$("#ApplyEditFeedButton"),s=$("#ClearBg"),I=$("#UsageButton"),o=$("#CandidatesModalWindow"),l=$("#EditFeedModalWindow"),a=$("#CandidatesList"),d=$("#FeedList"),w=$("#NoFeedIsAdded"),x=$("#NoFeedIsFound"),k=$("#NoFeedIsAdded"),v=$("#NewArticleIsAdded"),y=$("#NewFeedIsAdded"),u=$("#FeedListIsEditted"),B=$("#SomethingWrong"),L.on("connect",function(){var t,E;return H()?(L.emit("connect stream",V),D&&(L.emit("sync stream",V),""===i.html()&&w.show(),D=!1),setInterval(function(){return console.log("sync"),L.emit("sync stream",V)},6e4),I.click(function(){return i.css({zIndex:10}),$("body").chardinJs("start")}),$("body").click(function(){return $("body :not(#UsageButton)").chardinJs("stop")}),m.click(function(){return x.hide(),L.emit("find feed",f.val())}),L.on("found feed",function(t,e){var n,i,r,s;if(null!=t&&x.show(),null!=e.candidates){for(a.html(""),s=e.candidates,i=0,r=s.length;r>i;i++)n=s[i],n.sitetitle=""+n.sitename+" - "+(n.title||"feed"),n.siteurl=e.url,a.append(ViewHelper.candCheckbox(n));return o.modal()}}),L.on("sync completed",function(e){var n,i,r,a,o;for(r=_.sortBy(e,function(t){return Date.parse(t.page.pubDate)}),0!==e.length&&k.hide(),n=!1,a=0,o=r.length;o>a;a++)i=r[a],n=C(i);return t(),E(),n?A(v):void 0}),c.click(function(){return L.emit("get feed_list",V)}),L.on("got feed_list",function(t){var e,n,i;if(null!=t){for(d.html(""),n=0,i=t.length;i>n;n++)e=t[n],d.append(ViewHelper.feedList(e));return l.modal()}}),n.click(function(){var t;return t=[],d.find(":checkbox:checked").each(function(){return t.push($(this).attr("url"))}),L.emit("edit feed_list",{urls:t,stream:V})}),L.on("edit completed",function(){return A(u),F=[],i.html(""),console.log("sync by feed_list editted"),L.emit("sync stream",V)}),g.change(function(){var t,e;return t=event.target.files[0],e=new FileReader,q(t,function(e){return L.emit("upload bg",{file:e,name:t.name,stream:V})})}),L.on("bg uploaded",function(t){var e,n;return e=null!=(n="url("+t+")")?n:"none",r.css({backgroundImage:e,opacity:"0.2"})}),s.click(function(){return L.emit("clear bg",{stream:V})}),L.on("bg cleared",function(){return r.css({backgroundImage:"none",opacity:"0.2"})}),b.keyup(function(){return L.emit("change desc",{text:b.text(),stream:V})}),L.on("desc changed",function(t){return b.text(t.text)}),e.click(function(){var t;return t=[],a.find(":checkbox:checked").each(function(){return t.push({url:$(this).val(),title:$(this).attr("title"),siteurl:$(this).attr("siteurl")})}),0!==t.length?L.emit("add feed",{urls:t,stream:V}):void 0}),L.on("add-feed succeed",function(){return A(y),console.log("sync"),L.emit("sync stream",V)}),L.on("star added",function(t){var e;return e=$(document).find("#"+t.domid),e.find("span.starred").html(ViewHelper.starredIcon(!0)),e.find("span.starButton").html(ViewHelper.starredButton(!0)),E()}),L.on("star deleted",function(t){var e;return e=$(document).find("#"+t.domid),e.find("span.starred").html(ViewHelper.starredIcon(!1)),e.find("span.starButton").html(ViewHelper.starredButton(!1)),E()}),L.on("comment added",function(t){var e,n,i,r,a;for(e=$(document).find("#"+t.domid),e.find(".comments").html(""),a=t.comments,i=0,r=a.length;r>i;i++)n=a[i],e.find(".comments").append("<blockquote>"+n+"</blockquote>");return e.find(".commentsLength").text(t.comments.length)}),L.on("error",function(){return A(B)}),t=function(){return $(".fancy").fancybox({fitToView:!1,width:"70%",height:"100%",autoSize:!0,closeClick:!0,openEffect:"none",closeEffect:"none"}),$(".read-more").click(function(){var t;return t=$(this).parent(),t.find("a.fancy").click()}),$(".submitComment").click(function(){var t,e;return t=$(this).parent(),e=t.find(".inputComment").val(),null!=e?L.emit("add comment",{domid:t.attr("id"),comment:e,stream:V}):void 0})},E=function(){return $(".starredButton").click(function(){var t,e;return t=$(this).parent().parent(),e=$(this).attr("value"),"star"===e?L.emit("add star",{domid:t.attr("id")}):"unstar"===e?L.emit("delete star",{domid:t.attr("id"),stream:V}):void 0})}):p.click(function(){return window.location.href=h.val()})}),A=function(t){return t.toggle("fade",500),setTimeout(function(){return t.toggle("fade",500)},5e3)},H=function(){return""===V?!1:!0},q=function(t,e){var n,i;return i=new FileReader,n={},i.readAsBinaryString(t),i.onload=function(t){return e(t.target.result)}},C=function(e){var n,r,a,o,s,c,l,u,d,m,f,p;for(d={title:e.page.title,id:e.page._id,comments:e.page.comments,description:e.page.description,pubDate:e.page.pubDate,url:e.page.url,sitename:e.feed.title,favicon:e.feed.site.match(/http:\/\/.+?\//)+"favicon.ico",siteurl:e.feed.site,starred:e.page.starred},r="",p=e.page.comments,m=0,f=p.length;f>m;m++)n=p[m],r+=ViewHelper.comment(n);return u=i.find("li:first").attr("pubDate"),c=Date.parse(d.pubDate),s=c>=u,o=void 0===u,l=d.title,a=t.call(F,l)>=0,s&&!a||o?(i.prepend(ViewHelper.mediaHead(d)+r+ViewHelper.mediaFoot(d)).hide().fadeIn(500),F.push(l),!0):!1}})}.call(this);